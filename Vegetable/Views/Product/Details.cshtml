@model Product
@{
    List<ProductReview> productReviews = ViewBag.productReview;
    List<Product> productRelated = ViewBag.productRelated;
}


<section class="breadcrumb-section set-bg" data-setbg="/img/breadcrumb.jpg">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 text-center">
                <div class="breadcrumb__text">
                    <h2>Vegetable’s Package</h2>
                    <div class="breadcrumb__option">
                        <a href="./index.html">Trang chủ</a>
                        <a href="./index.html">Vegetables</a>
                        <span>Vegetable’s Package</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Breadcrumb Section End -->
<!-- Product Details Section Begin -->
<section class="product-details spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-6 col-md-6">
                <div class="product__details__pic">
                    <div class="product__details__pic__item">
                        <img class="product__details__pic__item--large"
                        src="~/img/product/image_veget/@Model.ImageUrl" alt="">
                    </div>
                    <div class="product__details__pic__slider owl-carousel">
                        @foreach (var item in productRelated.OrderBy(x => Guid.NewGuid()).Take(6))
                        {
                            <img data-imgbigurl="~/img/product/image_veget/@item.ImageUrl"
                                 src="~/img/product/image_veget/@item.ImageUrl" alt="">
                        }
                    </div>
                </div>
            </div>
            <div class="col-lg-6 col-md-6">
                <div class="product__details__text">
                    <h3>@Model.ProductName</h3>
                    <div class="product__details__rating">
                        @for(var i = 0; i < Model.Star; i++){
                            <i class="fa fa-star"></i>
                        }
                        <span>@productReviews.Count() Đánh giá</span>
                    </div>
                    <div class="product__details__price">@Model.Price</div>
                    <p>
                        @Model.Description
                    </p>
                    <div class="product__details__quantity">
                        <div class="quantity">
                            <div class="pro-qty">
                                <input type="text" value="1">
                            </div>
                        </div>
                    </div>
                    <a href="#" class="primary-btn">Thêm vào giỏ</a>
                    <a href="#" class="heart-icon"><span class="icon_heart_alt"></span></a>
                    <ul>
                        <li><b>Khả dụng</b> <span> Còn hàng</span></li>
                        <li><b>Tồn kho</b> <span> Còn @Model.StockQuantity<samp> sản phẩm</samp></span></li>
                        <li><b>Khối lượng</b> <span>@Model.Weight g</span></li>   
                        <li>
                            <b>Chia sẻ </b>
                            <div class="share">
                                <a href="#"><i class="fa fa-facebook"></i></a>
                                <a href="#"><i class="fa fa-twitter"></i></a>
                                <a href="#"><i class="fa fa-instagram"></i></a>
                                <a href="#"><i class="fa fa-pinterest"></i></a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="product__details__tab">
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" data-toggle="tab" href="#tabs-1" role="tab"
                               aria-selected="true">Miêu tả</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#tabs-2" role="tab"
                               aria-selected="false">Thông tin</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#tabs-3" role="tab"
                               aria-selected="false">Đánh giá <span>(@productReviews.Count())</span></a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="tabs-1" role="tabpanel">
                            <div class="product__details__tab__desc">
                                <h6>Miêu tả</h6>
                                <p>
                                 @Model.Description
                                </p>
                              
                            </div>
                        </div>
                        <div class="tab-pane" id="tabs-2" role="tabpanel">
                            <div class="product__details__tab__desc">
                                <h6>Products Infomation</h6>
                                <p>
                                    Vestibulum ac diam sit amet quam vehicula elementum sed sit amet dui.
                                    Pellentesque in ipsum id orci porta dapibus. Proin eget tortor risus.
                                    Vivamus suscipit tortor eget felis porttitor volutpat. Vestibulum ac diam
                                    sit amet quam vehicula elementum sed sit amet dui. Donec rutrum congue leo
                                    eget malesuada. Vivamus suscipit tortor eget felis porttitor volutpat.
                                    Curabitur arcu erat, accumsan id imperdiet et, porttitor at sem. Praesent
                                    sapien massa, convallis a pellentesque nec, egestas non nisi. Vestibulum ac
                                    diam sit amet quam vehicula elementum sed sit amet dui. Vestibulum ante
                                    ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae;
                                    Donec velit neque, auctor sit amet aliquam vel, ullamcorper sit amet ligula.
                                    Proin eget tortor risus.
                                </p>
                                <p>
                                    Praesent sapien massa, convallis a pellentesque nec, egestas non nisi. Lorem
                                    ipsum dolor sit amet, consectetur adipiscing elit. Mauris blandit aliquet
                                    elit, eget tincidunt nibh pulvinar a. Cras ultricies ligula sed magna dictum
                                    porta. Cras ultricies ligula sed magna dictum porta. Sed porttitor lectus
                                    nibh. Mauris blandit aliquet elit, eget tincidunt nibh pulvinar a.
                                </p>
                            </div>
                        </div>
                        <div class="tab-pane" id="tabs-3" role="tabpanel">
                            <div class="product__details__tab__desc">
                                <div class="blog-comment pt-4">
                                    <h4 class="product__details__tab__desc">@productReviews.Count() Bình luận</h4>
                                    <div class="container my-5">
                                        <div class="row">
                                            <div class="card text-body">
                                                @foreach (var item in productReviews)
                                                {
                                                    <div class="card-body p-2">
                                                        <div class="d-flex flex-start">
                                                            <img class="rounded-circle shadow-1-strong me-5"
                                                                 src="~/img/productCmt/@item.Image" alt="avatar" width="60"
                                                                 height="60" />
                                                            <div class="ml-5">

                                                                <div class="d-flex align-items-center mb-3">
                                                                    <h6 class="fw-bold ">@item.Prname</h6>
                                                                    <p class="mb-4">
                                                                        @item.CreatedAt
                                                                    </p>
                                                                </div>
                                                                <p class="mb-2">
                                                                    @item.Comment
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <hr class="my-0" />
                                                }
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <h4 class="mb-3 fw-bold">Gửi bình luận</h4>
                                <form id="contact-form">
                                    <div class="row g-3">
                                        <input type="hidden" id="c_productId" value="@Model.ProductId" />
                                        <div class="col-md-6">
                                            <label for="c_name" class="form-label">Your Name*</label>
                                            <input type="text" id="c_name" name="name" class="form-control" placeholder="Your Name" required>
                                        </div>
                                        <div class="col-md-6 d-flex ">
                                            <select id="c_rating" name="star" class="form-select" required >
                                                <option value="" disabled selected >Đánh giá</option>
                                                <option value="1">1 sao</option>
                                                <option value="2">2 sao</option>
                                                <option value="3">3 sao</option>
                                                <option value="4">4 sao</option>
                                                <option value="5">5 sao</option>
                                            </select>
                                        </div>

                                        <div class="col-12">
                                            <label for="c_message" class="form-label">Message*</label>
                                            <textarea name="message" id="c_message" class="form-control" rows="5" placeholder="Your Message" required></textarea>
                                        </div>
                                        <div class="col-12 mt-3">
                                            <button type="button" id="c_submit" class="btn btn-primary w-100">Gửi bình luận</button>
                                        </div>
                                    </div>
                                </form>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Product Details Section End -->
<!-- Related Product Section Begin -->
<section class="related-product">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="section-title related__product__title">
                    <h2>Sản phẩm liên quan</h2>
                </div>
            </div>
        </div>
        <div class="row">
            @foreach (var item in productRelated.OrderBy(x => Guid.NewGuid()).Take(4))
            {
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="product__item">
                        <div class="product__item__pic set-bg" data-setbg="/img/product/image_veget/@item.ImageUrl">
                            <ul class="product__item__pic__hover">
                                <li><a href="#"><i class="fa fa-heart"></i></a></li>
                                <li><a href="#"><i class="fa fa-retweet"></i></a></li>
                                <li><a href="#"><i class="fa fa-shopping-cart"></i></a></li>
                            </ul>
                        </div>
                        <div class="product__item__text">
                            <h6><a href="#">@item.ProductName</a></h6>
                            @if (item.PriceSale == 0)
                            {
                                <h5>$@item.Price</h5>
                            }
                            else
                            {
                                <div style="display: flex; justify-content:center;">
                                    <h5>
                                        @item.PriceSale₫
                                    </h5>
                                    <h5 style="margin-left: 5px;text-decoration: line-through;">@item.Price₫</h5>
                                </div>
                            }
                        </div>
                    </div>
                </div>
         }
        </div>
    </div>
</section>
@section Scripts {
    <script>
        $(document).ready(function () {
                   $("#c_submit").click(function (event) {
            event.preventDefault();

            let _productId = $("#c_productId").val().trim();
            let _name = $("#c_name").val().trim();
           let _rating = parseInt($("#c_rating").val().trim());
            let _message = $("#c_message").val().trim();

            if (!_name || !_rating || !_message) {
                toastr.error("Vui lòng điền đầy đủ thông tin!");
                return;
            }
            $.ajax({
                url: "/Product/Create",
                type: "POST",
                data: {
                    ProductId : _productId,
                    name: _name,
                    rating: _rating,
                    message: _message
                },
                success: function (result) {
                    if (result.status) {
                        $("#c_name").val("");
                        $("#c_rating").val("");
                        $("#c_message").val("");
                        toastr.success("Gửi thành công!");
                    } else {
                        toastr.error("Gửi không thành công!");
                    }
                },
                error: function () {
                    toastr.error("Có lỗi xảy ra, vui lòng thử lại!");
                }
            });
        });

        });
    </script>
}